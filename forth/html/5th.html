<html>

<!-- see https://github.com/mame/xterm-pty#emscripten-integration -->

<head>
    <title>demo</title>
    <link rel="stylesheet" href="/assets/node_modules/@xterm/xterm/css/xterm.css">
</head>

<body>
    <div id="terminal"></div>
    <script type="module">
        import "/assets/node_modules/@xterm/xterm/lib/xterm.js";
        import { openpty } from "/assets/node_modules/xterm-pty/index.mjs";
        import initEmscripten from "/assets/5th.mjs";

        const xterm = new Terminal();
        xterm.open(document.getElementById("terminal"));

        const { master, slave } = openpty();
        xterm.loadAddon(master);

        const response = await fetch("/forth/jonesforth.f");
        const preamble = new Uint8Array(await response.arrayBuffer());
        slave.ldisc.toUpperBuf.push(...preamble);

        await initEmscripten({ pty: slave });
        slave.ldisc.flushToUpper();
    </script>
</body>

</html>